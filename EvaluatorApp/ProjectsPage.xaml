<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             x:Class="EvaluatorApp.ProjectsPage"
             BackgroundColor="{StaticResource BackgroundLight}"
             Title="Lista de Proyectos"
             Shell.NavBarIsVisible="False"
             ios:Page.UseSafeArea="False">

    <Grid RowDefinitions="Auto, Auto, Auto, *">
        
        <!-- Header Section -->
        <Grid Grid.Row="0" ColumnDefinitions="*, Auto" Padding="16,60,16,8" BackgroundColor="{StaticResource BackgroundLight}">
            <Label Text="Lista de Proyectos" 
                   FontAttributes="Bold" 
                   FontSize="20" 
                   TextColor="{StaticResource TextPrimary}" 
                   VerticalOptions="Center"/>
            <Button Grid.Column="1" 
                    Text="âš™ï¸" 
                    BackgroundColor="Transparent" 
                    TextColor="{StaticResource TextPrimary}"
                    HeightRequest="40" 
                    WidthRequest="40" 
                    CornerRadius="20"/>
        </Grid>

        <!-- Search Bar -->
        <Grid Grid.Row="1" Padding="16,0,16,12" BackgroundColor="{StaticResource BackgroundLight}">
            <Border StrokeThickness="0" 
                    BackgroundColor="White" 
                    StrokeShape="RoundRectangle 12"
                    HeightRequest="44">
                <Grid ColumnDefinitions="40, *, 40">
                    <Label Text="ðŸ”" 
                           TextColor="{StaticResource TextSecondary}" 
                           HorizontalOptions="Center" 
                           VerticalOptions="Center"/>
                    <Entry Grid.Column="1" 
                           Placeholder="Buscar por nombre o alumno..." 
                           PlaceholderColor="{StaticResource TextSecondary}"
                           TextColor="{StaticResource TextPrimary}"
                           VerticalOptions="Center"
                           Background="Transparent"/>
                    <Label Grid.Column="2" 
                           Text="ðŸŽšï¸" 
                           TextColor="{StaticResource Primary}" 
                           HorizontalOptions="Center" 
                           VerticalOptions="Center"/>
                </Grid>
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.05" Radius="2" Offset="0,1"/>
                </Border.Shadow>
            </Border>
        </Grid>

        <!-- Filter Chips -->
        <ScrollView Grid.Row="2" Orientation="Horizontal" HorizontalScrollBarVisibility="Never" Padding="16,0,16,16" BackgroundColor="{StaticResource BackgroundLight}">
            <HorizontalStackLayout Spacing="8">
                <Button x:Name="BtnAll"
                        Text="Todos" 
                        Clicked="OnFilterClicked"
                        CommandParameter="All"
                        FontSize="12" 
                        FontAttributes="Bold"
                        TextColor="White" 
                        BackgroundColor="{StaticResource Primary}" 
                        CornerRadius="16" 
                        HeightRequest="32" 
                        Padding="16,0"/>
                <Button x:Name="BtnPending"
                        Text="Pendientes" 
                        Clicked="OnFilterClicked"
                        CommandParameter="Pending"
                        FontSize="12" 
                        FontAttributes="None"
                        TextColor="{StaticResource TextPrimary}" 
                        BackgroundColor="White" 
                        BorderColor="{StaticResource Gray200}" 
                        BorderWidth="1"
                        CornerRadius="16" 
                        HeightRequest="32" 
                        Padding="16,0"/>
                <Button x:Name="BtnEvaluated"
                        Text="Evaluados" 
                        Clicked="OnFilterClicked"
                        CommandParameter="Evaluated"
                        FontSize="12" 
                        FontAttributes="None"
                        TextColor="{StaticResource TextPrimary}" 
                        BackgroundColor="White" 
                        BorderColor="{StaticResource Gray200}" 
                        BorderWidth="1"
                        CornerRadius="16" 
                        HeightRequest="32" 
                        Padding="16,0"/>
                <Button x:Name="Btn2024A"
                        Text="2024-A" 
                        Clicked="OnFilterClicked"
                        CommandParameter="2024-A"
                        FontSize="12" 
                        FontAttributes="None"
                        TextColor="{StaticResource TextPrimary}" 
                        BackgroundColor="White" 
                        BorderColor="{StaticResource Gray200}" 
                        BorderWidth="1"
                        CornerRadius="16" 
                        HeightRequest="32" 
                        Padding="16,0"/>
                 <Button x:Name="Btn2023B"
                        Text="2023-B" 
                        Clicked="OnFilterClicked"
                        CommandParameter="2023-B"
                        FontSize="12" 
                        FontAttributes="None"
                        TextColor="{StaticResource TextPrimary}" 
                        BackgroundColor="White" 
                        BorderColor="{StaticResource Gray200}" 
                        BorderWidth="1"
                        CornerRadius="16" 
                        HeightRequest="32" 
                        Padding="16,0"/>
            </HorizontalStackLayout>
        </ScrollView>

        <!-- Main Content: Project List -->
        <CollectionView Grid.Row="3" 
                        x:Name="ProjectsCollectionView" 
                        ItemsSource="{Binding Projects}"
                        SelectionMode="None"
                        BackgroundColor="{StaticResource BackgroundLight}">
            <CollectionView.EmptyView>
                <Grid>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="12">
                        <Label Text="ðŸ“­" 
                               FontSize="60" 
                               HorizontalOptions="Center"/>
                        <Label Text="{Binding EmptyStatusText}"
                               TextColor="{StaticResource TextSecondary}"
                               FontSize="16"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </Grid>
            </CollectionView.EmptyView>
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="16"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="16,0">
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnProjectTapped" CommandParameter="{Binding .}" NumberOfTapsRequired="1"/>
                        </Grid.GestureRecognizers>
                        <Border StrokeThickness="0" 
                                BackgroundColor="White" 
                                StrokeShape="RoundRectangle 16">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.04" Radius="8" Offset="0,2"/>
                            </Border.Shadow>
                            <Grid RowDefinitions="Auto, Auto, Auto" Padding="16">
                                
                                <!-- Top Row: Image + Title/Date -->
                                <Grid Grid.Row="0" ColumnDefinitions="64, *" ColumnSpacing="16">
                                    <Border Grid.Column="0" 
                                            HeightRequest="64" 
                                            WidthRequest="64" 
                                            StrokeShape="RoundRectangle 12" 
                                            StrokeThickness="0">
                                        <Image Source="{Binding ImageUrl}" Aspect="AspectFill" BackgroundColor="{StaticResource Gray100}"/>
                                    </Border>
                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                        <Label Text="{Binding Title}" 
                                               TextColor="{StaticResource TextPrimary}" 
                                               FontAttributes="Bold" 
                                               FontSize="15" 
                                               LineBreakMode="TailTruncation" 
                                               MaxLines="2"/>
                                        <HorizontalStackLayout Spacing="4" Margin="0,6,0,0">
                                            <Label Text="ðŸ“…" FontSize="12" TextColor="{StaticResource TextSecondary}"/>
                                            <Label Text="{Binding Cycle}" 
                                                   TextColor="{StaticResource TextSecondary}" 
                                                   FontSize="12" 
                                                   FontAttributes="None" 
                                                   TextTransform="Uppercase"/>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>
                                </Grid>

                                <!-- Description -->
                                <Label Grid.Row="1" 
                                       Text="{Binding Description}" 
                                       TextColor="#4b5563" 
                                       FontSize="13" 
                                       Margin="0,12,0,16" 
                                       LineBreakMode="TailTruncation" 
                                       MaxLines="2"/>

                                <!-- Footer: Status and Action -->
                                <Grid Grid.Row="2" ColumnDefinitions="Auto, *">
                                    <Border Grid.Column="0" 
                                            StrokeThickness="0" 
                                            BackgroundColor="{Binding StatusBackgroundColor}" 
                                            StrokeShape="RoundRectangle 999" 
                                            Padding="10,4">
                                        <HorizontalStackLayout Spacing="8">
                                            <BoxView Color="{Binding StatusColor}" HeightRequest="8" WidthRequest="8" CornerRadius="4" VerticalOptions="Center"/>
                                            <Label Text="{Binding StatusText}" 
                                                   TextColor="{Binding StatusTextColor}" 
                                                   FontSize="12" 
                                                   FontAttributes="Bold"/>
                                        </HorizontalStackLayout>
                                    </Border>
                                    
                                    <!-- Score if Evaluated -->
                                    <Border Grid.Column="1" 
                                            IsVisible="{Binding IsEvaluated}"
                                            HorizontalOptions="End"
                                            StrokeThickness="0"
                                            BackgroundColor="{StaticResource Gray100}"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="8,2">
                                         <HorizontalStackLayout Spacing="4">
                                            <Label Text="â­" FontSize="12" VerticalOptions="Center"/>
                                            <Label Text="{Binding Score}" FontAttributes="Bold" FontSize="12" TextColor="{StaticResource TextPrimary}" VerticalOptions="Center"/>
                                            <Label Text="/20" FontSize="10" TextColor="{StaticResource Gray400}" VerticalOptions="Center"/>
                                         </HorizontalStackLayout>
                                    </Border>
                                    
                                     <!-- Arrow if Pending -->
                                    <Label Grid.Column="1" 
                                           IsVisible="{Binding IsPending}"
                                           Text=">" 
                                           FontSize="20" 
                                           TextColor="{StaticResource Gray300}" 
                                           HorizontalOptions="End" 
                                           VerticalOptions="Center"/>
                                </Grid>
                            </Grid>
                        </Border>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            <CollectionView.Footer>
                <BoxView HeightRequest="100" Color="Transparent"/>
            </CollectionView.Footer>
        </CollectionView>

        <!-- Floating Action Button -->
        <Button Grid.Row="3"
                Text="+" 
                FontSize="28" 
                TextColor="White" 
                BackgroundColor="{StaticResource Primary}" 
                CornerRadius="28" 
                HeightRequest="56" 
                WidthRequest="56" 
                HorizontalOptions="End" 
                VerticalOptions="End" 
                Margin="16,16,16,16">
            <Button.Shadow>
                <Shadow Brush="{StaticResource Primary}" Opacity="0.4" Radius="14" Offset="0,4"/>
            </Button.Shadow>
        </Button>

    </Grid>
</ContentPage>
