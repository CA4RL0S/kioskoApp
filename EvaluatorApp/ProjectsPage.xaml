<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             xmlns:components="clr-namespace:EvaluatorApp.Components"
             x:Class="EvaluatorApp.ProjectsPage"
             BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}"
             Title="Lista de Proyectos"
             Shell.NavBarIsVisible="False"
             ios:Page.UseSafeArea="False">

    <Grid BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
        <RefreshView Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsRefreshing}">
            <ScrollView VerticalScrollBarVisibility="Never" BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
                <VerticalStackLayout BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
                    
                    <!-- Header Section -->
                    <Grid ColumnDefinitions="*" Padding="16,20,16,8" BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
                        <Label Text="Lista de Proyectos" 
                               FontAttributes="Bold" 
                               FontSize="24" 
                               TextColor="{AppThemeBinding Light={StaticResource TextPrimary}, Dark=White}" 
                               VerticalOptions="Center"/>
                    </Grid>

                    <!-- Search Bar -->
                    <Grid Padding="16,0,16,12" BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
                        <Border StrokeThickness="1" 
                                Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray800}}"
                                BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource SurfaceDark}}" 
                                StrokeShape="RoundRectangle 24"
                                HeightRequest="48"
                                Padding="0">
                            <Grid ColumnDefinitions="48, *" VerticalOptions="Center">
                                <Label Text="search" 
                                       FontFamily="MaterialIcons"
                                       FontSize="22"
                                       TextColor="{AppThemeBinding Light={StaticResource TextSecondary}, Dark={StaticResource TextSubDark}}" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center"/>
                                <Entry x:Name="SearchEntry"
                                       Grid.Column="1" 
                                       Placeholder="Buscar por nombre o alumno..." 
                                       PlaceholderColor="{AppThemeBinding Light={StaticResource TextSecondary}, Dark={StaticResource TextSubDark}}"
                                       TextColor="{AppThemeBinding Light={StaticResource TextPrimary}, Dark=White}"
                                       VerticalOptions="Center"
                                       BackgroundColor="Transparent"
                                       ClearButtonVisibility="Never"
                                       TextChanged="OnSearchTextChanged"/>
                            </Grid>
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.05" Radius="4" Offset="0,2"/>
                            </Border.Shadow>
                        </Border>
                    </Grid>

                    <!-- Filter Chips -->
                    <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never" Padding="16,0,16,16" BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
                        <HorizontalStackLayout Spacing="8">
                            <Button x:Name="BtnAll"
                                    Text="Todos" 
                                    Clicked="OnFilterClicked"
                                    CommandParameter="All"
                                    FontSize="13" 
                                    FontAttributes="Bold"
                                    TextColor="White" 
                                    BackgroundColor="{StaticResource Primary}" 
                                    CornerRadius="16" 
                                    HeightRequest="32" 
                                    Padding="16,0"/>
                            <Button x:Name="BtnPending"
                                    Text="Pendientes" 
                                    Clicked="OnFilterClicked"
                                    CommandParameter="Pending"
                                    FontSize="13" 
                                    FontAttributes="None"
                                    TextColor="{AppThemeBinding Light={StaticResource TextPrimary}, Dark=White}" 
                                    BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource SurfaceDark}}" 
                                    BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" 
                                    BorderWidth="1"
                                    CornerRadius="16" 
                                    HeightRequest="32" 
                                    Padding="16,0"/>
                            <Button x:Name="BtnEvaluated"
                                    Text="Evaluados" 
                                    Clicked="OnFilterClicked"
                                    CommandParameter="Evaluated"
                                    FontSize="13" 
                                    FontAttributes="None"
                                    TextColor="{AppThemeBinding Light={StaticResource TextPrimary}, Dark=White}" 
                                    BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource SurfaceDark}}" 
                                    BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" 
                                    BorderWidth="1"
                                    CornerRadius="16" 
                                    HeightRequest="32" 
                                    Padding="16,0"/>
                            <Button x:Name="Btn2024A"
                                    Text="2024-A" 
                                    Clicked="OnFilterClicked"
                                    CommandParameter="2024-A"
                                    FontSize="13" 
                                    FontAttributes="None"
                                    TextColor="{AppThemeBinding Light={StaticResource TextPrimary}, Dark=White}" 
                                    BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource SurfaceDark}}" 
                                    BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" 
                                    BorderWidth="1"
                                    CornerRadius="16" 
                                    HeightRequest="32" 
                                    Padding="16,0"/>
                             <Button x:Name="Btn2023B"
                                    Text="2023-B" 
                                    Clicked="OnFilterClicked"
                                    CommandParameter="2023-B"
                                    FontSize="13" 
                                    FontAttributes="None"
                                    TextColor="{AppThemeBinding Light={StaticResource TextPrimary}, Dark=White}" 
                                    BackgroundColor="{AppThemeBinding Light=White, Dark={StaticResource SurfaceDark}}" 
                                    BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" 
                                    BorderWidth="1"
                                    CornerRadius="16" 
                                    HeightRequest="32" 
                                    Padding="16,0"/>
                        </HorizontalStackLayout>
                    </ScrollView>

                    <!-- Project List via BindableLayout -->
                    <StackLayout x:Name="ProjectsListView"
                                 BindableLayout.ItemsSource="{Binding Projects}"
                                 Spacing="16"
                                 BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">
                        <BindableLayout.EmptyView>
                            <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="12" Padding="0,60">
                                <Label Text="ðŸ“­" 
                                       FontSize="60" 
                                       HorizontalOptions="Center"/>
                                <Label Text="{Binding EmptyStatusText}"
                                       TextColor="{AppThemeBinding Light={StaticResource TextSecondary}, Dark={StaticResource TextSubDark}}"
                                       FontSize="16"
                                       HorizontalOptions="Center"
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </BindableLayout.EmptyView>
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="16,0">
                                    <Grid.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnProjectTapped" CommandParameter="{Binding .}" NumberOfTapsRequired="1"/>
                                    </Grid.GestureRecognizers>
                                    <components:ProjectCard />
                                </Grid>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </StackLayout>

                    <!-- Bottom spacing for safe area -->
                    <BoxView HeightRequest="100" Color="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}"/>
                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>

        <!-- Floating Action Button (overlay on top of ScrollView) -->
        <Button Text="+" 
                FontSize="28" 
                TextColor="White" 
                BackgroundColor="{StaticResource Primary}" 
                CornerRadius="28" 
                HeightRequest="56" 
                WidthRequest="56" 
                HorizontalOptions="End" 
                VerticalOptions="End" 
                Margin="16,16,16,100">
            <Button.Shadow>
                <Shadow Brush="{StaticResource Primary}" Opacity="0.4" Radius="14" Offset="0,4"/>
            </Button.Shadow>
        </Button>

        <!-- Offline Banner (Spotify Style - Primary Color) -->
        <Grid VerticalOptions="End" BackgroundColor="{StaticResource Primary}" HeightRequest="40" IsVisible="{Binding IsOffline}" InputTransparent="True" ZIndex="100">
            <Label Text="No tienes conexiÃ³n a Internet" 
                   TextColor="White" 
                   FontSize="12" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center" 
                   VerticalOptions="Center"/>
        </Grid>
    </Grid>
</ContentPage>
